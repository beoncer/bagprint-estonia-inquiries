import{j as e}from"./ui-core-DIFKu14A.js";import{r as s}from"./react-core-CGKACH0y.js";import{B as i,E as t,W as a,Y as l,Q as r,V as o,s as n}from"./page-home-CQU8oqVu.js";import{I as d,S as c,d as u,e as h,f as v,g as m}from"./page-products-B7wMRW4G.js";import{L as j}from"./page-product-detail-BoFGybH8.js";import{D as x,a as g,b as p,c as k,d as b,e as f,T as N,f as y,g as w,h as S,i as C,j as _}from"./admin-main-DCIQnyrp.js";import{S as L}from"./admin-content-BiwFaqFs.js";import{t as V}from"./page-contact-CfDnysdY.js";import"./router-Enmi9DRI.js";import"./data-BmXeSXkP.js";import"./admin-auth-DWhB8gXl.js";const F={section:"logo",key:"",value:"",order:0,visible:!0},O={logo:"Logo ja kirjeldus",kiirlingid:"Kiirlingid",tootekategooriad:"Tootekategooriad",kontakt:"Kontakt"},J={logo:[{value:"logo_text",label:"Logo tekst"},{value:"logo_description",label:"Logo kirjeldus"}],kiirlingid:[{value:"column_title",label:"Veeru pealkiri"},{value:"link_label",label:"Lingitekst"}],tootekategooriad:[{value:"column_title",label:"Veeru pealkiri"},{value:"link_label",label:"Lingitekst"}],kontakt:[{value:"column_title",label:"Veeru pealkiri"},{value:"contact_label",label:"Kontaktitüüp"},{value:"contact_value",label:"Kontaktinfo"}]},q=()=>{const[q,E]=s.useState([]),[z,K]=s.useState(!0),[T,M]=s.useState(!1),[D,R]=s.useState(F),[B,I]=s.useState(null),[P,Q]=s.useState(!1),U=async()=>{K(!0);const{data:e,error:s}=await n.from("footer_content").select("id, section, key, value, order, visible").order("section",{ascending:!0}).order("order",{ascending:!0});!s&&e&&E(e),K(!1)};s.useEffect(()=>{U()},[]);const W=()=>{M(!1),R(F),I(null)},Y=async(e,s,i)=>{let t=[...q.filter(s=>s.section===e)];if("up"===i&&s>0)[t[s-1],t[s]]=[t[s],t[s-1]];else{if("down"!==i||s>=t.length-1)return;[t[s],t[s+1]]=[t[s+1],t[s]]}t=t.map((e,s)=>({...e,order:s})),await Promise.all(t.map(e=>n.from("footer_content").update({order:e.order}).eq("id",e.id))),U()},A=q.reduce((e,s)=>(e[s.section]||(e[s.section]=[]),e[s.section].push(s),e),{});return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Footer sisu"}),e.jsxs(x,{open:T,onOpenChange:M,children:[e.jsx(g,{asChild:!0,children:e.jsxs(i,{className:"bg-red-600 hover:bg-red-700",children:[e.jsx(t,{className:"mr-2 h-4 w-4"})," Lisa sisu"]})}),e.jsxs(p,{className:"sm:max-w-[500px]",children:[e.jsx(k,{children:e.jsx(b,{children:B?"Muuda sisu":"Lisa uus sisu"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{htmlFor:"section",children:"Sektsioon"}),e.jsx(d,{id:"section",value:D.section||"",onChange:e=>R({...D,section:e.target.value}),placeholder:"logo, kiirlingid, tootekategooriad, kontakt",disabled:!!B,className:B?"opacity-50":""})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{htmlFor:"key",children:"Võti (key)"}),e.jsxs(c,{value:D.key||"",onValueChange:e=>R({...D,key:e}),children:[e.jsx(u,{children:e.jsx(h,{placeholder:"Vali võti"})}),e.jsx(v,{children:(J[D.section||"logo"]||[]).map(s=>e.jsx(m,{value:s.value,children:s.label},s.value))})]})]}),"link_label"!==D.key||"kiirlingid"!==D.section&&"tootekategooriad"!==D.section?e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{htmlFor:"value",children:"Väärtus"}),e.jsx(d,{id:"value",value:D.value||"",onChange:e=>R({...D,value:e.target.value}),placeholder:"Sisu väärtus"})]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{children:"Lingitekst"}),e.jsx(d,{value:D.value?(()=>{try{return JSON.parse(D.value).label}catch{return D.value}})():"",onChange:e=>{let s="";try{s=JSON.parse(D.value||"{}").url||""}catch{}R({...D,value:JSON.stringify({label:e.target.value,url:s})})},placeholder:"Lingitekst (nt: Riidest kotid)"}),e.jsx(j,{children:"Lingiviide (URL)"}),e.jsx(d,{value:D.value?(()=>{try{return JSON.parse(D.value).url}catch{return""}})():"",onChange:e=>{let s="";try{s=JSON.parse(D.value||"{}").label||""}catch{}R({...D,value:JSON.stringify({label:s,url:e.target.value})})},placeholder:"/riidest-kotid"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{htmlFor:"visible",children:"Nähtav"}),e.jsx(L,{id:"visible",checked:D.visible??!0,onCheckedChange:e=>R({...D,visible:e})})]})]}),e.jsxs(f,{children:[e.jsx(i,{variant:"outline",onClick:W,children:"Tühista"}),e.jsx(i,{className:"bg-red-600 hover:bg-red-700",onClick:async()=>{if(Q(!0),!D.section||!D.key)return V({title:"Missing fields",description:"Section and key are required.",variant:"destructive"}),void Q(!1);if(B){const{error:e}=await n.from("footer_content").update({key:D.key,value:D.value,order:D.order,visible:D.visible}).eq("id",B);V(e?{title:"Error updating footer content",description:e.message,variant:"destructive"}:{title:"Footer content updated"})}else{let e=D.key;const s=q.filter(e=>e.section===D.section).length>0?Math.max(...q.filter(e=>e.section===D.section).map(e=>e.order||0)):0,{error:i}=await n.from("footer_content").insert({section:D.section,key:e,value:D.value,order:s+1,visible:D.visible??!0});V(i?{title:"Error adding footer content",description:i.message,variant:"destructive"}:{title:"Footer content added"})}Q(!1),W(),U()},disabled:P,children:B?"Salvesta muudatused":"Lisa sisu"})]})]})]})]}),z?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-red-600"})}):Object.keys(A).map(s=>e.jsxs("div",{className:"mb-10",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:O[s]||s}),e.jsx("div",{className:"bg-white rounded-md border",children:e.jsxs(N,{children:[e.jsx(y,{children:e.jsxs(w,{children:[e.jsx(S,{children:"Võti"}),e.jsx(S,{children:"Väärtus"}),e.jsx(S,{children:"Järjekord"}),e.jsx(S,{children:"Nähtav"}),e.jsx(S,{className:"text-right",children:"Tegevused"})]})}),e.jsx(C,{children:A[s].map((t,d)=>e.jsxs(w,{children:[e.jsx(_,{children:t.key}),e.jsx(_,{children:t.value}),e.jsx(_,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>Y(s,d,"up"),disabled:0===d,children:e.jsx(a,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>Y(s,d,"down"),disabled:d===A[s].length-1,children:e.jsx(l,{className:"h-4 w-4"})}),t.order]})}),e.jsx(_,{children:e.jsx(L,{checked:t.visible,onCheckedChange:e=>(async(e,s)=>{await n.from("footer_content").update({visible:s}).eq("id",e),U()})(t.id,e)})}),e.jsx(_,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>(e=>{e?(R(e),I(e.id)):(R(F),I(null)),M(!0)})(t),children:e.jsx(r,{className:"h-4 w-4"})}),e.jsx(i,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700",onClick:()=>(async e=>{if(!window.confirm("Delete this footer content item?"))return;const{error:s}=await n.from("footer_content").delete().eq("id",e);V(s?{title:"Error deleting footer content",description:s.message,variant:"destructive"}:{title:"Footer content deleted"}),U()})(t.id),children:e.jsx(o,{className:"h-4 w-4"})})]})})]},t.id))})]})})]},s))]})};export{q as default};
