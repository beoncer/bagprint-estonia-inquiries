import{j as e}from"./ui-core-DIFKu14A.js";import{r as a}from"./react-core-CGKACH0y.js";import{B as i,E as t,W as s,Y as l,Q as r,V as o,s as d}from"./page-home-CQU8oqVu.js";import{I as n}from"./page-products-B7wMRW4G.js";import{L as c}from"./page-product-detail-BoFGybH8.js";import{D as u,a as m,b as p,c as h,d as g,e as x,T as v,f as j,g as f,h as b,i as k,j as y}from"./admin-main-DCIQnyrp.js";import{S as N}from"./admin-content-BiwFaqFs.js";import{t as _}from"./page-contact-CfDnysdY.js";import"./router-Enmi9DRI.js";import"./data-BmXeSXkP.js";import"./admin-auth-DWhB8gXl.js";const w={title:"",description:"",category:"",tags:"",image_url:"",order:0,visible:!0},C=()=>{const[C,S]=a.useState([]),[P,T]=a.useState(!0),[K,M]=a.useState(!1),[A,E]=a.useState(w),[L,q]=a.useState(null),[z,F]=a.useState(!1),[$,V]=a.useState(!1),[D,B]=a.useState(""),[I,R]=a.useState(""),[U,J]=a.useState(""),[O,Q]=a.useState("Meie saavutused"),[W,Y]=a.useState(""),[G,H]=a.useState([{value:"",label:""}]),[X,Z]=a.useState("Valmis oma projekti alustama?"),[ee,ae]=a.useState("Arutame su ideid ja loome koos midagi ainulaadset, mis esindab su brändi parimal viisil."),[ie,te]=a.useState("Küsi pakkumist"),[se,le]=a.useState(!0),[re,oe]=a.useState(!1),[de,ne]=a.useState(!1),ce=async()=>{T(!0);const{data:e,error:a}=await d.from("portfolio").select("id, title, description, category, tags, image_url, order, visible").order("order",{ascending:!0});!a&&e&&S(e),T(!1)};a.useEffect(()=>{ce()},[]),a.useEffect(()=>{(async()=>{le(!0);const{data:e}=await d.from("website_content").select("key, value").eq("page","portfolio");if(e){B(e.find(e=>"portfolio_header"===e.key)?.value||""),R(e.find(e=>"portfolio_header_highlight"===e.key)?.value||""),J(e.find(e=>"portfolio_description"===e.key)?.value||""),Q(e.find(e=>"portfolio_achievements_title"===e.key)?.value||"Meie saavutused"),Y(e.find(e=>"portfolio_achievements_description"===e.key)?.value||"");const a=[];for(let i=1;6>=i;i++){const t=e.find(e=>e.key===`portfolio_achievement_${i}_value`)?.value||"",s=e.find(e=>e.key===`portfolio_achievement_${i}_label`)?.value||"";(t||s)&&a.push({value:t,label:s})}H(a.length?a:[{value:"",label:""}]),Z(e.find(e=>"portfolio_cta_title"===e.key)?.value||"Valmis oma projekti alustama?"),ae(e.find(e=>"portfolio_cta_text"===e.key)?.value||"Arutame su ideid ja loome koos midagi ainulaadset, mis esindab su brändi parimal viisil."),te(e.find(e=>"portfolio_cta_button"===e.key)?.value||"Küsi pakkumist")}le(!1)})()},[]);const ue=async(e,a)=>{let i=[...C];if("up"===a&&e>0)[i[e-1],i[e]]=[i[e],i[e-1]];else{if("down"!==a||e>=i.length-1)return;[i[e],i[e+1]]=[i[e+1],i[e]]}i=i.map((e,a)=>({...e,order:a})),await Promise.all(i.map(e=>d.from("portfolio").update({order:e.order}).eq("id",e.id))),ce()},me=(e,a,i)=>{H(t=>t.map((t,s)=>s===e?{...t,[a]:i}:t))};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Portfolio"}),e.jsxs(u,{open:K,onOpenChange:M,children:[e.jsx(m,{asChild:!0,children:e.jsxs(i,{className:"bg-red-600 hover:bg-red-700",children:[e.jsx(t,{className:"mr-2 h-4 w-4"})," Lisa projekt"]})}),e.jsxs(p,{className:"sm:max-w-[500px]",children:[e.jsx(h,{children:e.jsx(g,{children:L?"Muuda projekti":"Lisa uus projekt"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"title",children:"Pealkiri"}),e.jsx(n,{id:"title",value:A.title||"",onChange:e=>E({...A,title:e.target.value}),placeholder:"Näiteks: Restoran Noa puuvillakotid"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"description",children:"Kirjeldus"}),e.jsx(n,{id:"description",value:A.description||"",onChange:e=>E({...A,description:e.target.value}),placeholder:"Lühikirjeldus projektist"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"category",children:"Kategooria"}),e.jsx(n,{id:"category",value:A.category||"",onChange:e=>E({...A,category:e.target.value}),placeholder:"Näiteks: Riidest kotid"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"tags",children:"Sildid (komaga eraldatud)"}),e.jsx(n,{id:"tags",value:A.tags||"",onChange:e=>E({...A,tags:e.target.value}),placeholder:"nt: Puuvill, Logo trükk, Premium"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"image",children:"Põhipilt"}),e.jsx(n,{id:"image",type:"file",accept:"image/*",onChange:async e=>{const a=e.target.files?.[0];if(!a)return;V(!0);const i=`portfolio/${Date.now()}_${a.name}`,{data:t,error:s}=await d.storage.from("site-assets").upload(i,a,{upsert:!0});if(s)return _({title:"Image upload failed",description:s.message,variant:"destructive"}),void V(!1);const{data:l}=d.storage.from("site-assets").getPublicUrl(i);E(e=>({...e,image_url:l?.publicUrl||""})),V(!1),_({title:"Image uploaded"})},disabled:$}),A.image_url&&e.jsx("img",{src:A.image_url,alt:"Põhipilt",className:"mt-2 rounded w-full max-h-40 object-contain"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"visible",children:"Nähtav"}),e.jsx(N,{id:"visible",checked:A.visible??!0,onCheckedChange:e=>E({...A,visible:e})})]})]}),e.jsxs(x,{children:[e.jsx(i,{variant:"outline",onClick:()=>{M(!1),E(w),q(null)},children:"Tühista"}),e.jsx(i,{className:"bg-red-600 hover:bg-red-700",onClick:async()=>{if(F(!0),!A.title)return _({title:"Missing title",description:"Title is required.",variant:"destructive"}),void F(!1);if(L){const{error:e}=await d.from("portfolio").update({title:A.title,description:A.description,category:A.category,tags:A.tags,image_url:A.image_url,order:A.order,visible:A.visible}).eq("id",L);_(e?{title:"Error updating portfolio item",description:e.message,variant:"destructive"}:{title:"Portfolio item updated"})}else{const e=C.length>0?Math.max(...C.map(e=>e.order||0)):0,{error:a}=await d.from("portfolio").insert({title:A.title,description:A.description,category:A.category,tags:A.tags,image_url:A.image_url,order:e+1,visible:A.visible??!0});_(a?{title:"Error adding portfolio item",description:a.message,variant:"destructive"}:{title:"Portfolio item added"})}F(!1),M(!1),ce()},disabled:z,children:L?"Salvesta muudatused":"Lisa projekt"})]})]})]})]}),P?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-red-600"})}):e.jsx("div",{className:"bg-white rounded-md border",children:e.jsxs(v,{children:[e.jsx(j,{children:e.jsxs(f,{children:[e.jsx(b,{children:"Järjekord"}),e.jsx(b,{children:"Pealkiri"}),e.jsx(b,{children:"Kategooria"}),e.jsx(b,{children:"Sildid"}),e.jsx(b,{children:"Pilt"}),e.jsx(b,{children:"Nähtav"}),e.jsx(b,{className:"text-right",children:"Tegevused"})]})}),e.jsx(k,{children:0===C.length?e.jsx(f,{children:e.jsx(y,{colSpan:7,className:"text-center py-6 text-gray-500",children:"Ühtegi projekti ei leitud"})}):C.map((a,t)=>e.jsxs(f,{children:[e.jsx(y,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>ue(t,"up"),disabled:0===t,children:e.jsx(s,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>ue(t,"down"),disabled:t===C.length-1,children:e.jsx(l,{className:"h-4 w-4"})}),a.order]})}),e.jsx(y,{children:a.title}),e.jsx(y,{children:a.category}),e.jsx(y,{children:a.tags}),e.jsx(y,{children:a.image_url?e.jsx("img",{src:a.image_url,alt:"Pilt",className:"w-16 h-16 object-cover rounded"}):null}),e.jsx(y,{children:e.jsx(N,{checked:a.visible,onCheckedChange:e=>(async(e,a)=>{await d.from("portfolio").update({visible:a}).eq("id",e),ce()})(a.id,e)})}),e.jsx(y,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>(e=>{e?(E(e),q(e.id)):(E(w),q(null)),M(!0)})(a),children:e.jsx(r,{className:"h-4 w-4"})}),e.jsx(i,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700",onClick:()=>(async e=>{if(!window.confirm("Delete this portfolio item?"))return;const{error:a}=await d.from("portfolio").delete().eq("id",e);_(a?{title:"Error deleting portfolio item",description:a.message,variant:"destructive"}:{title:"Portfolio item deleted"}),ce()})(a.id),children:e.jsx(o,{className:"h-4 w-4"})})]})})]},a.id))})]})}),e.jsxs("form",{className:"space-y-8 max-w-2xl mb-10",onSubmit:async e=>{e.preventDefault(),oe(!0),ne(!1);const a=[{page:"portfolio",key:"portfolio_header",value:D},{page:"portfolio",key:"portfolio_header_highlight",value:I},{page:"portfolio",key:"portfolio_description",value:U},{page:"portfolio",key:"portfolio_achievements_title",value:O},{page:"portfolio",key:"portfolio_achievements_description",value:W},...G.map((e,a)=>[{page:"portfolio",key:`portfolio_achievement_${a+1}_value`,value:e.value},{page:"portfolio",key:`portfolio_achievement_${a+1}_label`,value:e.label}]).flat(),{page:"portfolio",key:"portfolio_cta_title",value:X},{page:"portfolio",key:"portfolio_cta_text",value:ee},{page:"portfolio",key:"portfolio_cta_button",value:ie}],{error:i}=await d.from("website_content").upsert(a,{onConflict:"page,key"});oe(!1),i||ne(!0)},children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Portfoolio lehe sisu"}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1",children:"Pealkiri (header)"}),e.jsx("input",{type:"text",className:"w-full border rounded px-3 py-2",placeholder:"Meie portfoolio",value:D,onChange:e=>B(e.target.value),disabled:se||re})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1",children:"Tõsta esile sõna (highlight word)"}),e.jsx("input",{type:"text",className:"w-full border rounded px-3 py-2",placeholder:"portfoolio",value:I,onChange:e=>R(e.target.value),disabled:se||re}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Sisesta sõna, mida soovid pealkirjas punase värviga esile tõsta"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1",children:"Kirjeldus (description)"}),e.jsx("textarea",{className:"w-full border rounded px-3 py-2",placeholder:"Tutvu meie valmistatud kottidega...",rows:2,value:U,onChange:e=>J(e.target.value),disabled:se||re})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Meie saavutused"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block font-medium mb-1",children:"Bloki pealkiri"}),e.jsx("input",{type:"text",className:"w-full border rounded px-3 py-2",placeholder:"Meie saavutused",value:O,onChange:e=>Q(e.target.value),disabled:se||re})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block font-medium mb-1",children:"Bloki kirjeldus"}),e.jsx("textarea",{className:"w-full border rounded px-3 py-2",placeholder:"Numbrid, mis räägivad meie kogemusest",rows:2,value:W,onChange:e=>Y(e.target.value),disabled:se||re})]}),G.map((a,t)=>e.jsxs("div",{className:"flex gap-2 mb-2 items-center",children:[e.jsx("input",{type:"text",className:"border rounded px-2 py-1 w-24",placeholder:"Väärtus",value:a.value,onChange:e=>me(t,"value",e.target.value),disabled:se||re}),e.jsx("input",{type:"text",className:"border rounded px-2 py-1 flex-1",placeholder:"Silt",value:a.label,onChange:e=>me(t,"label",e.target.value),disabled:se||re}),e.jsx(i,{type:"button",variant:"outline",size:"sm",onClick:()=>(e=>H(a=>a.filter((a,i)=>i!==e)))(t),disabled:1===G.length||se||re,children:"Eemalda"})]},t)),e.jsx(i,{type:"button",variant:"secondary",size:"sm",onClick:()=>H([...G,{value:"",label:""}]),disabled:se||re,children:"Lisa saavutus"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Kutse tegevusele (CTA)"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block font-medium mb-1",children:"Pealkiri (CTA title)"}),e.jsx("input",{type:"text",className:"w-full border rounded px-3 py-2",placeholder:"Valmis oma projekti alustama?",value:X,onChange:e=>Z(e.target.value),disabled:se||re})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block font-medium mb-1",children:"Kirjeldus (CTA text)"}),e.jsx("textarea",{className:"w-full border rounded px-3 py-2",placeholder:"Arutame su ideid ja loome koos midagi ainulaadset, mis esindab su brändi parimal viisil.",rows:2,value:ee,onChange:e=>ae(e.target.value),disabled:se||re})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1",children:"Nupp (CTA button text)"}),e.jsx("input",{type:"text",className:"w-full border rounded px-3 py-2",placeholder:"Küsi pakkumist",value:ie,onChange:e=>te(e.target.value),disabled:se||re})]})]}),e.jsx(i,{type:"submit",disabled:se||re,children:re?"Salvestan...":"Salvesta sisu"}),de&&e.jsx("div",{className:"text-green-600 mt-2",children:"Salvestatud!"})]})]})};export{C as default};
