import{j as e,s as t,T as s,t as r,v as a,w as i,x as n,y as o,O as l,c,a as d,R as u,b as p,d as h,f as m,P as f,h as g,A as x,p as y,i as b,l as v,n as j,S as _,m as w,F as N,D as C,C as k,o as S,z as E}from"./ui-core-DIFKu14A.js";import{r as R,e as z,d as P}from"./react-core-CGKACH0y.js";import{c as O,k as F,X as A,n as I,w as D,x as T,A as L,o as U,F as M,I as B,S as $,s as q,a as K,D as W,B as H,E as Q,J as V,K as J,u as Z,M as G,q as X,N as Y,Q as ee,V as te}from"./page-home-CQU8oqVu.js";import{u as se,I as re,P as ae,S as ie,d as ne,e as oe,f as le,g as ce}from"./page-products-B7wMRW4G.js";import{L as de,T as ue,B as pe}from"./page-product-detail-BoFGybH8.js";import{u as he,t as me}from"./page-contact-CfDnysdY.js";import{u as fe}from"./admin-auth-DWhB8gXl.js";const ge=F("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function xe({className:t,variant:s,...r}){return e.jsx("div",{className:O(ge({variant:s}),t),...r})}const ye=t,be=s,ve=r,je=R.forwardRef(({className:t,...s},r)=>e.jsx(l,{ref:r,className:O("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s}));je.displayName=l.displayName;const _e=R.forwardRef(({className:t,children:s,...r},n)=>e.jsxs(ve,{children:[e.jsx(je,{}),e.jsxs(a,{ref:n,className:O("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r,children:[s,e.jsxs(i,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));_e.displayName=a.displayName;const we=({className:t,...s})=>e.jsx("div",{className:O("flex flex-col space-y-1.5 text-center sm:text-left",t),...s});we.displayName="DialogHeader";const Ne=({className:t,...s})=>e.jsx("div",{className:O("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});Ne.displayName="DialogFooter";const Ce=R.forwardRef(({className:t,...s},r)=>e.jsx(n,{ref:r,className:O("text-lg font-semibold leading-none tracking-tight",t),...s}));Ce.displayName=n.displayName;const ke=R.forwardRef(({className:t,...s},r)=>e.jsx(o,{ref:r,className:O("text-sm text-muted-foreground",t),...s}));ke.displayName=o.displayName;const Se=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const[t,s]=R.useState({productCount:0,contentCount:0,assetsCount:0,seoCount:0}),[r,a]=R.useState(!0);return R.useEffect(()=>{(async()=>{try{const{count:e,error:t}=await q.from("products").select("*",{count:"exact",head:!0}),{count:r,error:a}=await q.from("website_content").select("*",{count:"exact",head:!0}),{count:i,error:n}=await q.from("site_assets").select("*",{count:"exact",head:!0}),{count:o,error:l}=await q.from("seo_metadata").select("*",{count:"exact",head:!0});if(t||a||n||l)throw Error("Error fetching dashboard data");s({productCount:e||0,contentCount:r||0,assetsCount:i||0,seoCount:o||0})}catch(e){}finally{a(!1)}})()},[]),r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-red-600"})}):e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Dashboard"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(I,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between pb-2 space-y-0",children:[e.jsx(T,{className:"text-sm font-medium",children:"Products"}),e.jsx(L,{className:"h-5 w-5 text-gray-500"})]}),e.jsxs(U,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.productCount}),e.jsx("p",{className:"text-xs text-gray-500",children:"Number of products"})]})]}),e.jsxs(I,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between pb-2 space-y-0",children:[e.jsx(T,{className:"text-sm font-medium",children:"Content"}),e.jsx(M,{className:"h-5 w-5 text-gray-500"})]}),e.jsxs(U,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.contentCount}),e.jsx("p",{className:"text-xs text-gray-500",children:"Number of content elements"})]})]}),e.jsxs(I,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between pb-2 space-y-0",children:[e.jsx(T,{className:"text-sm font-medium",children:"Media"}),e.jsx(B,{className:"h-5 w-5 text-gray-500"})]}),e.jsxs(U,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.assetsCount}),e.jsx("p",{className:"text-xs text-gray-500",children:"Banner and logo"})]})]}),e.jsxs(I,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between pb-2 space-y-0",children:[e.jsx(T,{className:"text-sm font-medium",children:"SEO"}),e.jsx($,{className:"h-5 w-5 text-gray-500"})]}),e.jsxs(U,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.seoCount}),e.jsx("p",{className:"text-xs text-gray-500",children:"Number of SEO metadata"})]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Welcome!"}),e.jsx("p",{className:"text-gray-600",children:"In this admin panel, you can manage your website content, products, images, and SEO settings. Use the sidebar on the left to navigate between different sections."})]})]})}},Symbol.toStringTag,{value:"Module"})),Ee=R.forwardRef(({className:t,...s},r)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:r,className:O("w-full caption-bottom text-sm",t),...s})}));Ee.displayName="Table";const Re=R.forwardRef(({className:t,...s},r)=>e.jsx("thead",{ref:r,className:O("[&_tr]:border-b",t),...s}));Re.displayName="TableHeader";const ze=R.forwardRef(({className:t,...s},r)=>e.jsx("tbody",{ref:r,className:O("[&_tr:last-child]:border-0",t),...s}));ze.displayName="TableBody",R.forwardRef(({className:t,...s},r)=>e.jsx("tfoot",{ref:r,className:O("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...s})).displayName="TableFooter";const Pe=R.forwardRef(({className:t,...s},r)=>e.jsx("tr",{ref:r,className:O("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...s}));Pe.displayName="TableRow";const Oe=R.forwardRef(({className:t,...s},r)=>e.jsx("th",{ref:r,className:O("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...s}));Oe.displayName="TableHead";const Fe=R.forwardRef(({className:t,...s},r)=>e.jsx("td",{ref:r,className:O("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...s}));Fe.displayName="TableCell",R.forwardRef(({className:t,...s},r)=>e.jsx("caption",{ref:r,className:O("mt-4 text-sm text-muted-foreground",t),...s})).displayName="TableCaption";var Ae="Popover",[Ie,De]=p(Ae,[c]),Te=c(),[Le,Ue]=Ie(Ae),Me=t=>{const{__scopePopover:s,children:r,open:a,defaultOpen:i,onOpenChange:n,modal:o=!1}=t,l=Te(s),c=R.useRef(null),[p,m]=R.useState(!1),[f=!1,g]=d({prop:a,defaultProp:i,onChange:n});return e.jsx(u,{...l,children:e.jsx(Le,{scope:s,contentId:h(),triggerRef:c,open:f,onOpenChange:g,onOpenToggle:R.useCallback(()=>g(e=>!e),[g]),hasCustomAnchor:p,onCustomAnchorAdd:R.useCallback(()=>m(!0),[]),onCustomAnchorRemove:R.useCallback(()=>m(!1),[]),modal:o,children:r})})};Me.displayName=Ae;var Be="PopoverAnchor";R.forwardRef((t,s)=>{const{__scopePopover:r,...a}=t,i=Ue(Be,r),n=Te(r),{onCustomAnchorAdd:o,onCustomAnchorRemove:l}=i;return R.useEffect(()=>(o(),()=>l()),[o,l]),e.jsx(x,{...n,...a,ref:s})}).displayName=Be;var $e="PopoverTrigger",qe=R.forwardRef((t,s)=>{const{__scopePopover:r,...a}=t,i=Ue($e,r),n=Te(r),o=m(s,i.triggerRef),l=e.jsx(f.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":et(i.open),...a,ref:o,onClick:g(t.onClick,i.onOpenToggle)});return i.hasCustomAnchor?l:e.jsx(x,{asChild:!0,...n,children:l})});qe.displayName=$e;var Ke="PopoverPortal",[We,He]=Ie(Ke,{forceMount:void 0}),Qe=t=>{const{__scopePopover:s,forceMount:r,children:a,container:i}=t,n=Ue(Ke,s);return e.jsx(We,{scope:s,forceMount:r,children:e.jsx(y,{present:r||n.open,children:e.jsx(b,{asChild:!0,container:i,children:a})})})};Qe.displayName=Ke;var Ve="PopoverContent",Je=R.forwardRef((t,s)=>{const r=He(Ve,t.__scopePopover),{forceMount:a=r.forceMount,...i}=t,n=Ue(Ve,t.__scopePopover);return e.jsx(y,{present:a||n.open,children:n.modal?e.jsx(Ze,{...i,ref:s}):e.jsx(Ge,{...i,ref:s})})});Je.displayName=Ve;var Ze=R.forwardRef((t,s)=>{const r=Ue(Ve,t.__scopePopover),a=R.useRef(null),i=m(s,a),n=R.useRef(!1);return R.useEffect(()=>{const e=a.current;if(e)return v(e)},[]),e.jsx(j,{as:_,allowPinchZoom:!0,children:e.jsx(Xe,{...t,ref:i,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:g(t.onCloseAutoFocus,e=>{e.preventDefault(),n.current||r.triggerRef.current?.focus()}),onPointerDownOutside:g(t.onPointerDownOutside,e=>{const t=e.detail.originalEvent,s=0===t.button&&!0===t.ctrlKey,r=2===t.button||s;n.current=r},{checkForDefaultPrevented:!1}),onFocusOutside:g(t.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1})})})}),Ge=R.forwardRef((t,s)=>{const r=Ue(Ve,t.__scopePopover),a=R.useRef(!1),i=R.useRef(!1);return e.jsx(Xe,{...t,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:e=>{t.onCloseAutoFocus?.(e),e.defaultPrevented||(a.current||r.triggerRef.current?.focus(),e.preventDefault()),a.current=!1,i.current=!1},onInteractOutside:e=>{t.onInteractOutside?.(e),e.defaultPrevented||(a.current=!0,"pointerdown"===e.detail.originalEvent.type&&(i.current=!0));const s=e.target,n=r.triggerRef.current?.contains(s);n&&e.preventDefault(),"focusin"===e.detail.originalEvent.type&&i.current&&e.preventDefault()}})}),Xe=R.forwardRef((t,s)=>{const{__scopePopover:r,trapFocus:a,onOpenAutoFocus:i,onCloseAutoFocus:n,disableOutsidePointerEvents:o,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:u,...p}=t,h=Ue(Ve,r),m=Te(r);return w(),e.jsx(N,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:i,onUnmountAutoFocus:n,children:e.jsx(C,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:u,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onDismiss:()=>h.onOpenChange(!1),children:e.jsx(k,{"data-state":et(h.open),role:"dialog",id:h.contentId,...m,...p,ref:s,style:{...p.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Ye="PopoverClose";function et(e){return e?"open":"closed"}R.forwardRef((t,s)=>{const{__scopePopover:r,...a}=t,i=Ue(Ye,r);return e.jsx(f.button,{type:"button",...a,ref:s,onClick:g(t.onClick,()=>i.onOpenChange(!1))})}).displayName=Ye,R.forwardRef((t,s)=>{const{__scopePopover:r,...a}=t,i=Te(r);return e.jsx(S,{...i,...a,ref:s})}).displayName="PopoverArrow";var tt=Qe,st=Je;const rt=Me,at=qe,it=R.forwardRef(({className:t,align:s="center",sideOffset:r=4,...a},i)=>e.jsx(tt,{children:e.jsx(st,{ref:i,align:s,sideOffset:r,className:O("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...a})}));it.displayName=st.displayName;var nt="Checkbox",[ot,lt]=p(nt),[ct,dt]=ot(nt),ut=R.forwardRef((t,s)=>{const{__scopeCheckbox:r,name:a,checked:i,defaultChecked:n,required:o,disabled:l,value:c="on",onCheckedChange:u,form:p,...h}=t,[x,y]=R.useState(null),b=m(s,e=>y(e)),v=R.useRef(!1),j=!x||p||!!x.closest("form"),[_=!1,w]=d({prop:i,defaultProp:n,onChange:u}),N=R.useRef(_);return R.useEffect(()=>{const e=x?.form;if(e){const t=()=>w(N.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[x,w]),e.jsxs(ct,{scope:r,state:_,disabled:l,children:[e.jsx(f.button,{type:"button",role:"checkbox","aria-checked":ft(_)?"mixed":_,"aria-required":o,"data-state":gt(_),"data-disabled":l?"":void 0,disabled:l,value:c,...h,ref:b,onKeyDown:g(t.onKeyDown,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:g(t.onClick,e=>{w(e=>!!ft(e)||!e),j&&(v.current=e.isPropagationStopped(),v.current||e.stopPropagation())})}),j&&e.jsx(mt,{control:x,bubbles:!v.current,name:a,value:c,checked:_,required:o,disabled:l,form:p,style:{transform:"translateX(-100%)"},defaultChecked:!ft(n)&&n})]})});ut.displayName=nt;var pt="CheckboxIndicator",ht=R.forwardRef((t,s)=>{const{__scopeCheckbox:r,forceMount:a,...i}=t,n=dt(pt,r);return e.jsx(y,{present:a||ft(n.state)||!0===n.state,children:e.jsx(f.span,{"data-state":gt(n.state),"data-disabled":n.disabled?"":void 0,...i,ref:s,style:{pointerEvents:"none",...t.style}})})});ht.displayName=pt;var mt=t=>{const{control:s,checked:r,bubbles:a=!0,defaultChecked:i,...n}=t,o=R.useRef(null),l=se(r),c=E(s);R.useEffect(()=>{const e=o.current,t=window.HTMLInputElement.prototype,s=Object.getOwnPropertyDescriptor(t,"checked").set;if(l!==r&&s){const t=new Event("click",{bubbles:a});e.indeterminate=ft(r),s.call(e,!ft(r)&&r),e.dispatchEvent(t)}},[l,r,a]);const d=R.useRef(!ft(r)&&r);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:i??d.current,...n,tabIndex:-1,ref:o,style:{...t.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function ft(e){return"indeterminate"===e}function gt(e){return ft(e)?"indeterminate":e?"checked":"unchecked"}var xt=ut,yt=ht;const bt=R.forwardRef(({className:t,...s},r)=>e.jsx(xt,{ref:r,className:O("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...s,children:e.jsx(yt,{className:O("flex items-center justify-center text-current"),children:e.jsx(K,{className:"h-4 w-4"})})}));bt.displayName=xt.displayName;const vt=({onColorImagesChange:t,currentColorImages:s={},availableColors:r,mainColor:a,onMainColorChange:i,productTitle:n})=>{const[o,l]=R.useState(null),{toast:c}=he(),{user:d,session:u}=fe(),p=(e,r)=>{const a=e.target.files?.[0];a&&(async(e,r)=>{if(e.type.startsWith("image/"))if(e.size>5242880)c({title:"Error",description:"Image size must be less than 5MB",variant:"destructive"});else{l(r);try{const i=e.name.split(".").pop()?.toLowerCase()||"jpg",o=Date.now(),l=`products/color-images/${a=n,a.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9\-]/g,"").replace(/\-+/g,"-").replace(/^-+|-+$/g,"")}-${r}-${o}.${i}`,{data:d,error:u}=await q.storage.from("site-assets").upload(l,e,{cacheControl:"3600",upsert:!0});if(u)throw u;const{data:{publicUrl:p}}=q.storage.from("site-assets").getPublicUrl(l),h={...s,[r]:p};t(h),c({title:"Success",description:r+" image uploaded successfully"})}catch(i){c({title:"Upload Failed",description:i.message||`Failed to upload ${r} image`,variant:"destructive"})}finally{l(null)}var a}else c({title:"Error",description:"Please select an image file",variant:"destructive"})})(a,r),e.target.value=""},h=e=>{const t=ae.find(t=>t.value===e);return t?.label||e};return d&&u?e.jsxs("div",{className:"space-y-4",children:[e.jsx(de,{className:"text-base font-semibold",children:"Color-Specific Images"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Upload different images for each color variant. Mark one as the main image (shown as default on product page)."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(r=>{const l=s[r],c=o===r,d=`${n} ${r}`;return e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(xe,{style:(u=r,{naturalne:{backgroundColor:"#F5F5DC"},oranz:{backgroundColor:"#FFA500"},pehme_kollane:{backgroundColor:"#F0E68C"},punane:{backgroundColor:"#FF0000"},roosa:{backgroundColor:"#FFC0CB"},royal_sinine:{backgroundColor:"#4169E1"},taevasinine:{backgroundColor:"#87CEEB"},tume_roheline:{backgroundColor:"#006400"},tume_sinine:{backgroundColor:"#000080"},valge:{backgroundColor:"#FFFFFF",color:"#000000"},granate:{backgroundColor:"#800020"},hall:{backgroundColor:"#808080"},hele_roheline:{backgroundColor:"#90EE90"},kollane:{backgroundColor:"#FFFF00",color:"#000000"},lilla:{backgroundColor:"#800080"},must:{backgroundColor:"#000000"}}[u]||{backgroundColor:"#CCCCCC"}),className:"text-white font-medium",children:h(r)}),l&&e.jsx(H,{type:"button",variant:"destructive",size:"sm",onClick:()=>(e=>{const r={...s};delete r[e],t(r),a===e&&i&&i("")})(r),disabled:c,children:e.jsx(A,{className:"h-3 w-3"})})]}),l&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"radio",name:"mainColor",checked:a===r,onChange:()=>i&&i(r),disabled:!l}),e.jsx("span",{className:"text-xs",children:"Set as main image"}),a===r&&e.jsx("span",{className:"ml-1 text-blue-600 text-xs font-semibold",children:"(Main)"})]}),l?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:l,alt:d,className:"w-full h-32 object-cover rounded border"}),e.jsx("div",{className:"mt-2",children:e.jsx(re,{type:"file",accept:"image/*",onChange:e=>p(e,r),disabled:c,className:"text-xs"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center",children:[e.jsx(B,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"No image uploaded"}),e.jsx(re,{type:"file",accept:"image/*",onChange:e=>p(e,r),disabled:c,className:"text-xs"})]}),c&&e.jsxs("div",{className:"text-center text-sm text-gray-500",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-red-600 mx-auto mb-1"}),"Uploading..."]})]},r);var u})}),0===r.length&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(B,{className:"mx-auto h-12 w-12 mb-4"}),e.jsx("p",{children:"No colors selected for this product."}),e.jsx("p",{className:"text-sm",children:"Add colors to the product to upload color-specific images."})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(de,{className:"text-base font-semibold",children:"Color-Specific Images"}),e.jsxs("div",{className:"border rounded-lg p-6 text-center",children:[e.jsx(W,{className:"mx-auto h-12 w-12 text-yellow-500 mb-4"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Authentication Required"}),e.jsx("p",{className:"text-gray-600",children:"Please log in to upload color images."})]})]})},jt=({onSizeImagesChange:t,currentSizeImages:s={},availableSizes:r,productTitle:a})=>{const[i,n]=R.useState(null),{toast:o}=he(),l=(e,r)=>{const i=e.target.files?.[0];i&&(async(e,r)=>{if(e.type.startsWith("image/"))if(e.size>5242880)o({title:"Error",description:"Image size must be less than 5MB",variant:"destructive"});else{n(r);try{const n=e.name.split(".").pop(),l=`products/size-images/${i=a,i.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9\-]/g,"").replace(/\-+/g,"-").replace(/^-+|-+$/g,"")}-${r}.${n}`,{data:c,error:d}=await q.storage.from("site-assets").upload(l,e);if(d)throw d;const{data:{publicUrl:u}}=q.storage.from("site-assets").getPublicUrl(l),p={...s,[r]:u};t(p),o({title:"Success",description:r+" image uploaded successfully"})}catch(l){o({title:"Error",description:`Failed to upload ${r} image`,variant:"destructive"})}finally{n(null)}var i}else o({title:"Error",description:"Please select an image file",variant:"destructive"})})(i,r)};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(de,{className:"text-base font-semibold",children:"Size-Specific Images"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Upload different images for each size variant. This will show the appropriate image when customers select a size (if no color-specific image is available)."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(r=>{const n=s[r],o=i===r,c=`${a} ${r}`;return e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(xe,{variant:"secondary",className:"font-medium",children:r}),n&&e.jsx(H,{type:"button",variant:"destructive",size:"sm",onClick:()=>(e=>{const r={...s};delete r[e],t(r)})(r),disabled:o,children:e.jsx(A,{className:"h-3 w-3"})})]}),n?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:n,alt:c,className:"w-full h-32 object-cover rounded border"}),e.jsx("div",{className:"mt-2",children:e.jsx(re,{type:"file",accept:"image/*",onChange:e=>l(e,r),disabled:o,className:"text-xs"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center",children:[e.jsx(B,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"No image uploaded"}),e.jsx(re,{type:"file",accept:"image/*",onChange:e=>l(e,r),disabled:o,className:"text-xs"})]}),o&&e.jsx("div",{className:"text-center text-sm text-gray-500",children:"Uploading..."})]},r)})}),0===r.length&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(B,{className:"mx-auto h-12 w-12 mb-4"}),e.jsx("p",{children:"No sizes selected for this product."}),e.jsx("p",{className:"text-sm",children:"Add sizes to the product to upload size-specific images."})]})]})};function _t({productId:t,sizes:s,onSizesChange:r}){const[a,i]=R.useState(""),[n,o]=R.useState(""),[l,c]=R.useState({}),{sizeMultipliers:d,loading:u,error:p,setSizeMultiplier:h,removeSizeMultiplier:m}=function(e){const[t,s]=R.useState({}),[r,a]=R.useState(!1),[i,n]=R.useState(null),o=async()=>{try{a(!0),n(null);const{data:t,error:r}=await q.from("products").select("size_multipliers").eq("id",e).single();if(r)throw r;s(t.size_multipliers||{})}catch(t){n(t instanceof Error?t.message:"Failed to fetch size multipliers")}finally{a(!1)}},l=async t=>{try{a(!0),n(null);const{error:r}=await q.from("products").update({size_multipliers:t}).eq("id",e);if(r)throw r;s(t)}catch(r){throw n(r instanceof Error?r.message:"Failed to update size multipliers"),r}finally{a(!1)}};return R.useEffect(()=>{e&&o()},[e]),{sizeMultipliers:t,loading:r,error:i,setSizeMultiplier:async(e,s)=>{const r={...t,[e]:s};await l(r)},removeSizeMultiplier:async e=>{const s={...t};delete s[e],await l(s)},getSizeMultiplier:e=>t[e]||1,updateSizeMultipliers:l,refresh:o}}(t);return u?e.jsx("div",{className:"text-center py-4",children:"Loading size multipliers..."}):p?e.jsxs("div",{className:"text-red-500 py-4",children:["Error: ",p]}):e.jsxs(I,{children:[e.jsx(D,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Sizes & Multipliers"}),e.jsxs(xe,{variant:"secondary",children:[s.length," sizes"]})]})}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(de,{htmlFor:"new-size",children:"Size"}),e.jsx(re,{id:"new-size",placeholder:"e.g., 38x42cm",value:a,onChange:e=>i(e.target.value)})]}),e.jsxs("div",{className:"w-24",children:[e.jsx(de,{htmlFor:"new-multiplier",children:"Multiplier"}),e.jsx(re,{id:"new-multiplier",placeholder:"1.0",value:n,onChange:e=>o(e.target.value)})]}),e.jsx(H,{onClick:async()=>{if(!a.trim()||!n.trim())return void me({title:"Error",description:"Please enter both size and multiplier",variant:"destructive"});const e=parseFloat(n);if(!isNaN(e)&&e>0)try{if(!s.includes(a)){const e=[...s,a];r?.(e)}await h(a,e),i(""),o(""),me({title:"Success",description:`Added size ${a} with multiplier ${e}`})}catch(t){me({title:"Error",description:"Failed to add size and multiplier",variant:"destructive"})}else me({title:"Error",description:"Multiplier must be a positive number",variant:"destructive"})},className:"mt-6",size:"sm",children:e.jsx(Q,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-2",children:s.map(t=>e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded-lg",children:[e.jsx("span",{className:"flex-1 font-medium",children:t}),void 0!==l[t]?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{value:l[t],onChange:e=>c(s=>({...s,[t]:e.target.value})),className:"w-20"}),e.jsx(H,{onClick:()=>(async e=>{const t=parseFloat(l[e]);if(!isNaN(t)&&t>0)try{await h(e,t),c(t=>{const s={...t};return delete s[e],s}),me({title:"Success",description:"Updated multiplier for "+e})}catch(s){me({title:"Error",description:"Failed to update multiplier",variant:"destructive"})}else me({title:"Error",description:"Multiplier must be a positive number",variant:"destructive"})})(t),size:"sm",variant:"outline",children:e.jsx(V,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(xe,{variant:"outline",children:[d[t]||1,"x"]}),e.jsx(H,{onClick:()=>(e=>{c(t=>({...t,[e]:d[e]?.toString()||"1.0"}))})(t),size:"sm",variant:"ghost",children:"Edit"})]}),e.jsx(H,{onClick:()=>(async e=>{try{await m(e);const t=s.filter(t=>t!==e);r?.(t),me({title:"Success",description:"Removed size "+e})}catch(t){me({title:"Error",description:"Failed to remove size",variant:"destructive"})}})(t),size:"sm",variant:"ghost",className:"text-red-500 hover:text-red-700",children:e.jsx(A,{className:"h-4 w-4"})})]},t))}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("p",{children:"• Multiplier affects the final price: 1.0 = no change, 1.2 = 20% increase"}),e.jsx("p",{children:"• Larger sizes typically have higher multipliers"}),e.jsx("p",{children:"• Default multiplier is 1.0 for new sizes"})]})]})]})}const wt=z({exports:{}}.exports=function e(){var t,s="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==s?s:{},r=!s.document&&!!s.postMessage,a=s.IS_PAPA_WORKER||!1,i={},n=0,o={};function l(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var t=b(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new h(t),(this._handle.streamer=this)._config=t}.call(this,e),this.parseChunk=function(e,t){var r=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&r>0){let t=this._config.newline;t||(i=this._config.quoteChar||'"',t=this._handle.guessLineEndings(e,i)),e=[...e.split(t).slice(r)].join(t)}this.isFirstChunk&&j(this._config.beforeFirstChunk)&&void 0!==(i=this._config.beforeFirstChunk(e))&&(e=i),this.isFirstChunk=!1,this._halted=!1,r=this._partialLine+e;var i=(this._partialLine="",this._handle.parse(r,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(e=i.meta.cursor,this._finished||(this._partialLine=r.substring(e-this._baseIndex),this._baseIndex=e),i&&i.data&&(this._rowCount+=i.data.length),r=this._finished||this._config.preview&&this._rowCount>=this._config.preview,a)s.postMessage({results:i,workerId:o.WORKER_ID,finished:r});else if(j(this._config.chunk)&&!t){if(this._config.chunk(i,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=i=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(i.data),this._completeResults.errors=this._completeResults.errors.concat(i.errors),this._completeResults.meta=i.meta),this._completed||!r||!j(this._config.complete)||i&&i.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),r||i&&i.meta.paused||this._nextChunk(),i}this._halted=!0},this._sendError=function(e){j(this._config.error)?this._config.error(e):a&&this._config.error&&s.postMessage({workerId:o.WORKER_ID,error:e,finished:!1})}}function c(e){var t;(e=e||{}).chunkSize||(e.chunkSize=o.RemoteChunkSize),l.call(this,e),this._nextChunk=r?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),r||(t.onload=v(this._chunkLoaded,this),t.onerror=v(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!r),this._config.downloadRequestHeaders){var e,s=this._config.downloadRequestHeaders;for(e in s)t.setRequestHeader(e,s[e])}var a;this._config.chunkSize&&(a=this._start+this._config.chunkSize-1,t.setRequestHeader("Range","bytes="+this._start+"-"+a));try{t.send(this._config.downloadRequestBody)}catch(i){this._chunkError(i.message)}r&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){var e;4===t.readyState&&(200>t.status||t.status>=400?this._chunkError():(this._start+=this._config.chunkSize||t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(null!==(e=(e=t).getResponseHeader("Content-Range"))?parseInt(e.substring(e.lastIndexOf("/")+1)):-1),this.parseChunk(t.responseText)))},this._chunkError=function(e){e=t.statusText||e,this._sendError(Error(e))}}function d(e){(e=e||{}).chunkSize||(e.chunkSize=o.LocalChunkSize),l.call(this,e);var t,s,r="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,s=e.slice||e.webkitSlice||e.mozSlice,r?((t=new FileReader).onload=v(this._chunkLoaded,this),t.onerror=v(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&this._rowCount>=this._config.preview||this._readChunk()},this._readChunk=function(){var e=this._input,a=(this._config.chunkSize&&(a=Math.min(this._start+this._config.chunkSize,this._input.size),e=s.call(e,this._start,a)),t.readAsText(e,this._config.encoding));r||this._chunkLoaded({target:{result:a}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function u(e){var t;l.call(this,e=e||{}),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){var e,s;if(!this._finished)return e=this._config.chunkSize,t=e?(s=t.substring(0,e),t.substring(e)):(s=t,""),this._finished=!t,this.parseChunk(s)}}function p(e){l.call(this,e=e||{});var t=[],s=!0,r=!1;this.pause=function(){l.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){l.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){r&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):s=!0},this._streamData=v(function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),s&&(s=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(r){this._streamError(r)}},this),this._streamError=v(function(e){this._streamCleanUp(),this._sendError(e)},this),this._streamEnd=v(function(){this._streamCleanUp(),r=!0,this._streamData("")},this),this._streamCleanUp=v(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function h(e){var t,s,r,a,i=Math.pow(2,53),n=-i,l=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,c=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,d=this,u=0,p=0,h=!1,g=!1,x=[],y={data:[],errors:[],meta:{}};function v(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function _(){if(y&&r&&(N("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+o.DefaultDelimiter+"'"),r=!1),e.skipEmptyLines&&(y.data=y.data.filter(function(e){return!v(e)})),w()){let s=function(t,s){j(e.transformHeader)&&(t=e.transformHeader(t,s)),x.push(t)};if(y)if(Array.isArray(y.data[0])){for(var t=0;w()&&t<y.data.length;t++)y.data[t].forEach(s);y.data.splice(0,1)}else y.data.forEach(s)}function s(t,s){for(var r=e.header?{}:[],a=0;a<t.length;a++){var o=a,d=t[a];d=((t,s)=>{return r=t,e.dynamicTypingFunction&&void 0===e.dynamicTyping[r]&&(e.dynamicTyping[r]=e.dynamicTypingFunction(r)),!0===(e.dynamicTyping[r]||e.dynamicTyping)?"true"===s||"TRUE"===s||"false"!==s&&"FALSE"!==s&&((e=>{if(l.test(e)&&(e=parseFloat(e))>n&&i>e)return 1})(s)?parseFloat(s):c.test(s)?new Date(s):""===s?null:s):s;var r})(o=e.header?a<x.length?x[a]:"__parsed_extra":o,d=e.transform?e.transform(d,o):d),"__parsed_extra"===o?(r[o]=r[o]||[],r[o].push(d)):r[o]=d}return e.header&&(a>x.length?N("FieldMismatch","TooManyFields","Too many fields: expected "+x.length+" fields but parsed "+a,p+s):a<x.length&&N("FieldMismatch","TooFewFields","Too few fields: expected "+x.length+" fields but parsed "+a,p+s)),r}var a;y&&(e.header||e.dynamicTyping||e.transform)&&(a=1,!y.data.length||Array.isArray(y.data[0])?(y.data=y.data.map(s),a=y.data.length):y.data=s(y.data,0),e.header&&y.meta&&(y.meta.fields=x),p+=a)}function w(){return e.header&&0===x.length}function N(e,t,s,r){e={type:e,code:t,message:s},void 0!==r&&(e.row=r),y.errors.push(e)}j(e.step)&&(a=e.step,e.step=function(t){y=t,w()?_():(_(),0!==y.data.length&&(u+=t.data.length,e.preview&&u>e.preview?s.abort():(y.data=y.data[0],a(y,d))))}),this.parse=function(a,i,n){var l=e.quoteChar||'"';return e.newline||(e.newline=this.guessLineEndings(a,l)),r=!1,e.delimiter?j(e.delimiter)&&(e.delimiter=e.delimiter(a),y.meta.delimiter=e.delimiter):((l=((t,s,r,a,i)=>{var n,l,c,d;i=i||[",","\t","|",";",o.RECORD_SEP,o.UNIT_SEP];for(var u=0;u<i.length;u++){for(var p,h=i[u],m=0,g=0,x=0,y=(c=void 0,new f({comments:a,delimiter:h,newline:s,preview:10}).parse(t)),b=0;b<y.data.length;b++)r&&v(y.data[b])?x++:(g+=p=y.data[b].length,void 0===c?c=p:p>0&&(m+=Math.abs(p-c),c=p));y.data.length>0&&(g/=y.data.length-x),(void 0===l||l>=m)&&(void 0===d||g>d)&&g>1.99&&(l=m,n=h,d=g)}return{successful:!!(e.delimiter=n),bestDelimiter:n}})(a,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess)).successful?e.delimiter=l.bestDelimiter:(r=!0,e.delimiter=o.DefaultDelimiter),y.meta.delimiter=e.delimiter),l=b(e),e.preview&&e.header&&l.preview++,t=a,s=new f(l),y=s.parse(t,i,n),_(),h?{meta:{paused:!0}}:y||{meta:{paused:!1}}},this.paused=function(){return h},this.pause=function(){h=!0,s.abort(),t=j(e.chunk)?"":t.substring(s.getCharIndex())},this.resume=function(){d.streamer._halted?(h=!1,d.streamer.parseChunk(t,!0)):setTimeout(d.resume,3)},this.aborted=function(){return g},this.abort=function(){g=!0,s.abort(),y.meta.aborted=!0,j(e.complete)&&e.complete(y),t=""},this.guessLineEndings=function(e,t){e=e.substring(0,1048576),t=RegExp(m(t)+"([^]*?)"+m(t),"gm");var s=(e=e.replace(t,"")).split("\r");if(e=(t=e.split("\n")).length>1&&t[0].length<s[0].length,1===s.length||e)return"\n";for(var r=0,a=0;a<s.length;a++)"\n"===s[a][0]&&r++;return r<s.length/2?"\r":"\r\n"}}function m(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function f(e){var t=(e=e||{}).delimiter,s=e.newline,r=e.comments,a=e.step,i=e.preview,n=e.fastMode,l=null,c=!1,d=null==e.quoteChar?'"':e.quoteChar,u=d;if(void 0!==e.escapeChar&&(u=e.escapeChar),("string"!=typeof t||o.BAD_DELIMITERS.indexOf(t)>-1)&&(t=","),r===t)throw Error("Comment character same as delimiter");!0===r?r="#":("string"!=typeof r||o.BAD_DELIMITERS.indexOf(r)>-1)&&(r=!1),"\n"!==s&&"\r"!==s&&"\r\n"!==s&&(s="\n");var p=0,h=!1;this.parse=function(o,f,g){if("string"!=typeof o)throw Error("Input must be a string");var x=o.length,y=t.length,b=s.length,v=r.length,_=j(a),w=[],N=[],C=[],k=p=0;if(!o)return L();if(n||!1!==n&&-1===o.indexOf(d)){for(var S=o.split(s),E=0;E<S.length;E++){if(C=S[E],p+=C.length,E!==S.length-1)p+=s.length;else if(g)return L();if(!r||C.substring(0,v)!==r){if(_){if(w=[],A(C.split(t)),U(),h)return L()}else A(C.split(t));if(i&&E>=i)return w=w.slice(0,i),L(!0)}}return L()}for(var R=o.indexOf(t,p),z=o.indexOf(s,p),P=RegExp(m(u)+m(d),"g"),O=o.indexOf(d,p);;)if(o[p]===d)for(O=p,p++;;){if(-1===(O=o.indexOf(d,O+1)))return g||N.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:w.length,index:p}),D();if(O===x-1)return D(o.substring(p,O).replace(P,d));if(d===u&&o[O+1]===u)O++;else if(d===u||0===O||o[O-1]!==u){-1!==R&&O+1>R&&(R=o.indexOf(t,O+1));var F=I(-1===(z=-1!==z&&O+1>z?o.indexOf(s,O+1):z)?R:Math.min(R,z));if(o.substr(O+1+F,y)===t){C.push(o.substring(p,O).replace(P,d)),o[p=O+1+F+y]!==d&&(O=o.indexOf(d,p)),R=o.indexOf(t,p),z=o.indexOf(s,p);break}if(F=I(z),o.substring(O+1+F,O+1+F+b)===s){if(C.push(o.substring(p,O).replace(P,d)),T(O+1+F+b),R=o.indexOf(t,p),O=o.indexOf(d,p),_&&(U(),h))return L();if(i&&w.length>=i)return L(!0);break}N.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:w.length,index:p}),O++}}else if(r&&0===C.length&&o.substring(p,p+v)===r){if(-1===z)return L();p=z+b,z=o.indexOf(s,p),R=o.indexOf(t,p)}else if(-1===R||R>=z&&-1!==z){if(-1===z)break;if(C.push(o.substring(p,z)),T(z+b),_&&(U(),h))return L();if(i&&w.length>=i)return L(!0)}else C.push(o.substring(p,R)),p=R+y,R=o.indexOf(t,p);return D();function A(e){w.push(e),k=p}function I(e){return-1!==e&&(e=o.substring(O+1,e))&&""===e.trim()?e.length:0}function D(e){return g||(void 0===e&&(e=o.substring(p)),C.push(e),p=x,A(C),_&&U()),L()}function T(e){p=e,A(C),C=[],z=o.indexOf(s,p)}function L(r){if(e.header&&!f&&w.length&&!c){var a=w[0],i=Object.create(null),n=new Set(a);let t=!1;for(let s=0;s<a.length;s++){let r=a[s];if(i[r=j(e.transformHeader)?e.transformHeader(r,s):r]){let e,o=i[r];for(;e=r+"_"+o,o++,n.has(e););n.add(e),a[s]=e,i[r]++,t=!0,(l=null===l?{}:l)[e]=r}else i[r]=1,a[s]=r;n.add(r)}c=!0}return{data:w,errors:N,meta:{delimiter:t,linebreak:s,aborted:h,truncated:!!r,cursor:k+(f||0),renamedHeaders:l}}}function U(){a(L()),w=[],N=[]}},this.abort=function(){h=!0},this.getCharIndex=function(){return p}}function g(e){var t=e.data,s=i[t.workerId],r=!1;if(t.error)s.userError(t.error,t.file);else if(t.results&&t.results.data){var a={abort:function(){r=!0,x(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:y,resume:y};if(j(s.userStep)){for(var n=0;n<t.results.data.length&&(s.userStep({data:t.results.data[n],errors:t.results.errors,meta:t.results.meta},a),!r);n++);delete t.results}else j(s.userChunk)&&(s.userChunk(t.results,a,t.file),delete t.results)}t.finished&&!r&&x(t.workerId,t.results)}function x(e,t){var s=i[e];j(s.userComplete)&&s.userComplete(t),s.terminate(),delete i[e]}function y(){throw Error("Not implemented.")}function b(e){if("object"!=typeof e||null===e)return e;var t,s=Array.isArray(e)?[]:{};for(t in e)s[t]=b(e[t]);return s}function v(e,t){return function(){e.apply(t,arguments)}}function j(e){return"function"==typeof e}return o.parse=function(t,r){var a,l=(r=r||{}).dynamicTyping||!1;if(j(l)&&(r.dynamicTypingFunction=l,l={}),r.dynamicTyping=l,r.transform=!!j(r.transform)&&r.transform,!r.worker||!o.WORKERS_SUPPORTED)return l=null,o.NODE_STREAM_INPUT,"string"==typeof t?(t=65279!==(a=t).charCodeAt(0)?a:a.slice(1),l=new(r.download?c:u)(r)):!0===t.readable&&j(t.read)&&j(t.on)?l=new p(r):(s.File&&t instanceof File||t instanceof Object)&&(l=new d(r)),l.stream(t);(l=(()=>{var t,r,a;return!!o.WORKERS_SUPPORTED&&(r=s.URL||s.webkitURL||null,a=""+e,t=o.BLOB_URL||(o.BLOB_URL=r.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",a,")();"],{type:"text/javascript"}))),(t=new s.Worker(t)).onmessage=g,t.id=n++,i[t.id]=t)})()).userStep=r.step,l.userChunk=r.chunk,l.userComplete=r.complete,l.userError=r.error,r.step=j(r.step),r.chunk=j(r.chunk),r.complete=j(r.complete),r.error=j(r.error),delete r.worker,l.postMessage({input:t,config:r,workerId:l.id})},o.unparse=function(e,t){var s=!1,r=!0,a=",",i="\r\n",n='"',l=n+n,c=!1,d=null,u=!1,p=((()=>{if("object"==typeof t){if("string"!=typeof t.delimiter||o.BAD_DELIMITERS.filter(function(e){return-1!==t.delimiter.indexOf(e)}).length||(a=t.delimiter),"boolean"!=typeof t.quotes&&"function"!=typeof t.quotes&&!Array.isArray(t.quotes)||(s=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(c=t.skipEmptyLines),"string"==typeof t.newline&&(i=t.newline),"string"==typeof t.quoteChar&&(n=t.quoteChar),"boolean"==typeof t.header&&(r=t.header),Array.isArray(t.columns)){if(0===t.columns.length)throw Error("Option columns is empty");d=t.columns}void 0!==t.escapeChar&&(l=t.escapeChar+n),t.escapeFormulae instanceof RegExp?u=t.escapeFormulae:"boolean"==typeof t.escapeFormulae&&t.escapeFormulae&&(u=/^[=+\-@\t\r].*$/)}})(),RegExp(m(n),"g"));if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return h(null,e,c);if("object"==typeof e[0])return h(d||Object.keys(e[0]),e,c)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||d),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:"object"==typeof e.data[0]?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),h(e.fields||[],e.data||[],c);throw Error("Unable to serialize unrecognized input");function h(e,t,s){var n="",o=("string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t)),Array.isArray(e)&&e.length>0),l=!Array.isArray(t[0]);if(o&&r){for(var c=0;c<e.length;c++)c>0&&(n+=a),n+=f(e[c],c);t.length>0&&(n+=i)}for(var d=0;d<t.length;d++){var u=(o?e:t[d]).length,p=!1,h=o?0===Object.keys(t[d]).length:0===t[d].length;if(s&&!o&&(p="greedy"===s?""===t[d].join("").trim():1===t[d].length&&0===t[d][0].length),"greedy"===s&&o){for(var m=[],g=0;u>g;g++){var x=l?e[g]:g;m.push(t[d][x])}p=""===m.join("").trim()}if(!p){for(var y=0;u>y;y++){y>0&&!h&&(n+=a);var b=o&&l?e[y]:y;n+=f(t[d][b],y)}d<t.length-1&&(!s||u>0&&!h)&&(n+=i)}}return n}function f(e,t){var r,i;return null==e?"":e.constructor===Date?JSON.stringify(e).slice(1,25):(i=!1,u&&"string"==typeof e&&u.test(e)&&(e="'"+e,i=!0),r=e.toString().replace(p,l),(i=i||!0===s||"function"==typeof s&&s(e,t)||Array.isArray(s)&&s[t]||((e,t)=>{for(var s=0;s<t.length;s++)if(e.indexOf(t[s])>-1)return!0;return!1})(r,o.BAD_DELIMITERS)||r.indexOf(a)>-1||" "===r.charAt(0)||" "===r.charAt(r.length-1))?n+r+n:r)}},o.RECORD_SEP="",o.UNIT_SEP="",o.BYTE_ORDER_MARK="\ufeff",o.BAD_DELIMITERS=["\r","\n",'"',o.BYTE_ORDER_MARK],o.WORKERS_SUPPORTED=!r&&!!s.Worker,o.NODE_STREAM_INPUT=1,o.LocalChunkSize=10485760,o.RemoteChunkSize=5242880,o.DefaultDelimiter=",",o.Parser=f,o.ParserHandle=h,o.NetworkStreamer=c,o.FileStreamer=d,o.StringStreamer=u,o.ReadableStreamStreamer=p,s.jQuery&&((t=s.jQuery).fn.parse=function(e){var r=e.config||{},a=[];return this.each(function(e){if("INPUT"!==t(this).prop("tagName").toUpperCase()||"file"!==t(this).attr("type").toLowerCase()||!s.FileReader||!this.files||0===this.files.length)return!0;for(var i=0;i<this.files.length;i++)a.push({file:this.files[i],inputElem:this,instanceConfig:t.extend({},r)})}),i(),this;function i(){if(0===a.length)j(e.complete)&&e.complete();else{var s,r,i,l=a[0];if(j(e.before)){var c=e.before(l.file,l.inputElem);if("object"==typeof c){if("abort"===c.action)return s=l.file,r=l.inputElem,i=c.reason,void(j(e.error)&&e.error({name:"AbortError"},s,r,i));if("skip"===c.action)return void n();"object"==typeof c.config&&(l.instanceConfig=t.extend(l.instanceConfig,c.config))}else if("skip"===c)return void n()}var d=l.instanceConfig.complete;l.instanceConfig.complete=function(e){j(d)&&d(e,l.file,l.inputElem),n()},o.parse(l.file,l.instanceConfig)}}function n(){a.splice(0,1),i()}}),a&&(s.onmessage=function(e){e=e.data,void 0===o.WORKER_ID&&e&&(o.WORKER_ID=e.workerId),"string"==typeof e.input?s.postMessage({workerId:o.WORKER_ID,results:o.parse(e.input,e.config),finished:!0}):(s.File&&e.input instanceof File||e.input instanceof Object)&&(e=o.parse(e.input,e.config))&&s.postMessage({workerId:o.WORKER_ID,results:e,finished:!0})}),(c.prototype=Object.create(l.prototype)).constructor=c,(d.prototype=Object.create(l.prototype)).constructor=d,(u.prototype=Object.create(u.prototype)).constructor=u,(p.prototype=Object.create(l.prototype)).constructor=p,o}()),Nt=["name","description","slug","base_price","material","colors","sizes","badges","type","model","priority","seo_title","seo_description","seo_keywords"];function Ct(){const e=new Blob(["name,description,slug,base_price,material,colors,sizes,badges,type,model,priority,seo_title,seo_description,seo_keywords\nCotton Bag,An eco-friendly cotton bag,cotton-bag,1.5,140g cotton,Royal sinine,Punane,eco|organic,cotton_bag,CB001,50,Cotton Bag,An eco-friendly cotton bag,cotton-bag,1.5,140g cotton,Royal sinine,Punane,eco|organic,cotton_bag,CB001\n"],{type:"text/csv"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="product_upload_template.csv",s.click(),URL.revokeObjectURL(t)}function kt(e){return e?e.split(/[|,]/).map(e=>e.trim()).filter(Boolean):[]}const St=({open:t,onOpenChange:s,onUploadSuccess:r})=>{const a=R.useRef(null),[i,n]=R.useState([]),[o,l]=R.useState([]),[c,d]=R.useState(!1),[u,p]=R.useState({success:0,failed:0,errors:[]});return e.jsx(ye,{open:t,onOpenChange:s,children:e.jsxs(_e,{className:"max-w-2xl",children:[e.jsxs(we,{children:[e.jsx(Ce,{children:"Bulk Upload Products"}),e.jsxs(ke,{children:["Upload a CSV file to add or update products in bulk. ",e.jsx("br",{}),e.jsx(H,{variant:"link",type:"button",onClick:Ct,className:"px-0",children:"Download CSV Template"})]})]}),e.jsxs("div",{className:"my-4",children:[e.jsx("input",{ref:a,type:"file",accept:".csv",onChange:e=>{l([]),n([]),p({success:0,failed:0,errors:[]});const t=e.target.files?.[0];t&&wt.parse(t,{header:!0,skipEmptyLines:!0,complete:e=>{const t=[],s=e.data.map((e,s)=>{for(const r of["name","slug","base_price","type"])e[r]||t.push(`Row ${s+2}: Missing required field '${r}'`);return{name:e.name?.trim()||"",description:e.description?.trim()||"",slug:e.slug?.trim()||"",base_price:parseFloat(e.base_price),material:e.material?.trim()||"",colors:kt(e.colors),sizes:kt(e.sizes),badges:kt(e.badges),type:e.type?.trim()||"",model:e.model?.trim()||"",priority:parseInt(e.priority)||50,seo_title:e.seo_title?.trim()||"",seo_description:e.seo_description?.trim()||"",seo_keywords:e.seo_keywords?.trim()||""}});n(s),l(t)},error:e=>{l([e.message])}})},className:"mb-2",disabled:c}),o.length>0&&e.jsx("div",{className:"text-red-600 text-sm mb-2",children:o.map((t,s)=>e.jsx("div",{children:t},s))}),i.length>0&&e.jsx("div",{className:"overflow-x-auto max-h-64 border rounded mb-2",children:e.jsxs(Ee,{children:[e.jsx(Re,{children:e.jsx(Pe,{children:Nt.map(t=>e.jsx(Oe,{children:t},t))})}),e.jsx(ze,{children:i.map((t,s)=>e.jsx(Pe,{children:Nt.map(s=>e.jsx(Fe,{children:Array.isArray(t[s])?t[s].join(", "):t[s]},s))},s))})]})})]}),e.jsx(Ne,{children:e.jsx(H,{onClick:async()=>{d(!0),p({success:0,failed:0,errors:[]});let e=0,t=0,s=[];for(let r=0;r<i.length;r++){const n=i[r];if(o.length>0)t++,s.push(`Row ${r+2}: Skipped due to validation errors.`);else try{const{error:a}=await q.from("products").upsert([{name:n.name,description:n.description,slug:n.slug,base_price:n.base_price,material:n.material,colors:n.colors,sizes:n.sizes,badges:n.badges,type:n.type,model:n.model,priority:n.priority,seo_title:n.seo_title,seo_description:n.seo_description,seo_keywords:n.seo_keywords}],{onConflict:"slug"});a?(t++,s.push(`Row ${r+2}: ${a.message}`)):e++}catch(a){t++,s.push(`Row ${r+2}: ${a.message}`)}}d(!1),p({success:e,failed:t,errors:s}),e>0&&r&&r()},disabled:c||0===i.length||o.length>0,children:c?"Uploading...":"Upload"})}),u.success+u.failed>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"text-green-700",children:["Success: ",u.success]}),e.jsxs("div",{className:"text-red-700",children:["Failed: ",u.failed]}),u.errors.length>0&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:u.errors.map((t,s)=>e.jsx("div",{children:t},s))})]})]})})},Et=({onImageUploaded:t,currentImageUrl:s,label:r="Upload Image"})=>{const[a,i]=R.useState(!1),[n,o]=R.useState(!1),{toast:l}=he(),c=async e=>{if(e.type.startsWith("image/"))if(e.size>5242880)l({title:"Error",description:"Image size must be less than 5MB",variant:"destructive"});else{i(!0);try{const s=e.name.split(".").pop(),r=`blog/${Date.now()}.${s}`,{data:a,error:i}=await q.storage.from("blog-images").upload(r,e);if(i)throw i;const{data:{publicUrl:n}}=q.storage.from("blog-images").getPublicUrl(r);await q.from("site_assets").insert({type:"blog",url:n}),t(n),l({title:"Success",description:"Image uploaded successfully"})}catch(s){l({title:"Error",description:"Failed to upload image",variant:"destructive"})}finally{i(!1)}}else l({title:"Error",description:"Please select an image file",variant:"destructive"})};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(de,{children:r}),s?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s,alt:"Uploaded image",className:"w-full max-w-sm h-48 object-cover rounded-lg border"}),e.jsx(H,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:()=>{t("")},children:e.jsx(A,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center transition-colors "+(n?"border-primary bg-primary/5":"border-gray-300 hover:border-gray-400"),onDrop:e=>{e.preventDefault(),o(!1);const t=e.dataTransfer.files?.[0];t&&c(t)},onDragOver:e=>{e.preventDefault(),o(!0)},onDragLeave:e=>{e.preventDefault(),o(!1)},children:[e.jsx(B,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Drag and drop an image here, or click to select"}),e.jsx(re,{type:"file",accept:"image/*",onChange:e=>{const t=e.target.files?.[0];t&&c(t)},disabled:a,className:"hidden",id:"image-upload"}),e.jsxs(H,{type:"button",variant:"outline",disabled:a,onClick:()=>document.getElementById("image-upload")?.click(),children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),a?"Uploading...":"Choose Image"]})]})]})},Rt=({label:t="Upload Images",imageUrls:s,onChange:r})=>{const[a,i]=R.useState(!1),{toast:n}=he(),o=async e=>{if(e.type.startsWith("image/"))if(e.size>5242880)n({title:"Error",description:"Image size must be less than 5MB",variant:"destructive"});else{i(!0);try{const t=e.name.split(".").pop(),a=`products/additional-images/${Date.now()}-${Math.random().toString(36).slice(2)}.${t}`,{data:i,error:o}=await q.storage.from("site-assets").upload(a,e);if(o)throw o;const{data:{publicUrl:l}}=q.storage.from("site-assets").getPublicUrl(a);r([...s,l]),n({title:"Success",description:"Image uploaded successfully"})}catch(t){n({title:"Error",description:"Failed to upload image",variant:"destructive"})}finally{i(!1)}}else n({title:"Error",description:"Please select an image file",variant:"destructive"})};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(de,{children:t}),e.jsx("div",{className:"flex flex-wrap gap-4 mb-2",children:s.map((t,a)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t,alt:"Additional "+(a+1),className:"w-24 h-24 object-cover rounded border"}),e.jsx(H,{type:"button",variant:"destructive",size:"sm",className:"absolute top-1 right-1 opacity-80 group-hover:opacity-100",onClick:()=>(e=>{r(s.filter(t=>t!==e))})(t),children:e.jsx(A,{className:"h-4 w-4"})})]},t))}),e.jsx(re,{type:"file",accept:"image/*",multiple:!0,onChange:e=>{const t=e.target.files;t&&Array.from(t).forEach(o)},disabled:a}),a&&e.jsx("div",{className:"text-sm text-gray-500",children:"Uploading..."})]})},zt=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const[t,s]=R.useState([]),[r,a]=R.useState([]),[i,n]=R.useState([]),[o,l]=R.useState(!0),[c,d]=R.useState(null),[u,p]=R.useState(!1),[h,m]=R.useState(!1),[f,g]=R.useState(null),[x,y]=R.useState({type:"",name:"",description:"",base_price:0,slug:"",material:"",model:"",priority:50}),[b,v]=R.useState([]),[j,_]=R.useState([]),[w,N]=R.useState(!1),[C,k]=R.useState([]),[S,E]=R.useState(!1),[z,P]=R.useState(""),[F,I]=R.useState({}),[D,T]=R.useState({}),[L,U]=R.useState(""),[M,B]=R.useState(!1),[$,W]=R.useState([]),{calculatePrice:V,calculateMinimumPrice:J}=Z();R.useEffect(()=>{se(),he(),de()},[]),R.useEffect(()=>{c?(v(c.colors||[]),_(c.sizes||[]),k(c.badges||[]),N(c.is_eco||!1),I(c.color_images||{}),T(c.size_images||{}),U(c.main_color||""),W(c.additional_images||[])):(v([]),_([]),k([]),N(!1),I({}),T({}),U(""),W([]))},[c]);const se=async()=>{try{l(!0);const{data:e,error:t}=await q.from("products").select("*").order("priority",{ascending:!0});if(t)throw t;e&&s(e)}catch(e){me({title:"Error loading products",description:e.message,variant:"destructive"})}finally{l(!1)}},de=async()=>{try{const{data:e,error:t}=await q.from("products").select("material").not("material","is",null);if(t)throw t;const s=e&&Array.isArray(e)?[...new Set(e.map(e=>e.material).filter(Boolean))]:[];n(s)}catch(e){n([])}},he=async()=>{try{const{data:e,error:t}=await q.from("popular_products").select("*");if(t)throw t;e&&a(e)}catch(e){me({title:"Error loading popular products",description:e.message,variant:"destructive"})}},fe=e=>{const{name:t,value:s}=e.target;y(e=>({...e,[t]:"base_price"===t?parseFloat(s)||0:s}))},ge=e=>r.some(t=>t.product_id===e),be=()=>{p(!1),d(null),y({type:"",name:"",description:"",base_price:0,slug:"",material:"",model:"",priority:50,seo_title:"",seo_description:"",seo_keywords:""}),g(null),P("")},ve=e=>{switch(e){case"cotton_bag":return"Cotton Bag";case"paper_bag":return"Paper Bag";case"drawstring_bag":return"Drawstring Bag";case"shoebag":return"Shoe Bag";case"packaging_box":return"Packaging Box";default:return e}},je=e=>{const t=V({basePrice:e.base_price,quantity:50,withPrint:!1}),s=J(e.base_price,e.type);return t&&s?`From €${s.toFixed(2)} (min) / €${t.pricePerItem.toFixed(2)} (50pcs)`:"Base: €"+e.base_price.toFixed(2)};return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Products"}),e.jsxs("div",{className:"flex gap-2",children:[t.length>0&&e.jsx(H,{onClick:()=>function(e){const t=e.map(e=>({name:e.name||"",description:e.description||"",slug:e.slug||"",base_price:e.base_price||"",material:e.material||"",colors:Array.isArray(e.colors)?e.colors.join("|"):e.colors||"",sizes:Array.isArray(e.sizes)?e.sizes.join("|"):e.sizes||"",badges:Array.isArray(e.badges)?e.badges.join("|"):e.badges||"",type:e.type||"",model:e.model||"",priority:e.priority||50,seo_title:e.seo_title||"",seo_description:e.seo_description||"",seo_keywords:e.seo_keywords||""})),s=wt.unparse({fields:["name","description","slug","base_price","material","colors","sizes","badges","type","model","priority","seo_title","seo_description","seo_keywords"],data:t}),r=new Blob([s],{type:"text/csv"}),a=URL.createObjectURL(r),i=document.createElement("a");i.href=a,i.download="products_export.csv",i.click(),URL.revokeObjectURL(a)}(t),variant:"outline",children:"Export Products"}),e.jsx(H,{onClick:()=>B(!0),variant:"outline",children:"Bulk Upload"}),e.jsxs(H,{onClick:()=>p(!0),children:[e.jsx(Q,{className:"w-4 h-4 mr-2"})," Add New Product"]})]})]}),e.jsx(St,{open:M,onOpenChange:B,onUploadSuccess:se}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Products"}),e.jsx(ye,{open:u,onOpenChange:p,children:e.jsxs(_e,{className:"max-h-[90vh] overflow-y-auto",children:[e.jsxs(we,{children:[e.jsx(Ce,{children:c?"Edit Product":"Add New Product"}),e.jsxs(ke,{children:["Fill in the fields to ",c?"edit":"add"," a product."]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsxs(ie,{value:x.type,onValueChange:e=>{y(t=>({...t,type:e}))},children:[e.jsx(ne,{children:e.jsx(oe,{placeholder:"Select product type"})}),e.jsxs(le,{children:[e.jsx(ce,{value:"cotton_bag",children:"Cotton Bag"}),e.jsx(ce,{value:"paper_bag",children:"Paper Bag"}),e.jsx(ce,{value:"drawstring_bag",children:"Drawstring Bag"}),e.jsx(ce,{value:"shoebag",children:"Shoe Bag"})]})]})}),e.jsx("div",{className:"space-y-2",children:e.jsx(re,{name:"name",placeholder:"Product Name",value:x.name,onChange:fe})}),e.jsx("div",{className:"space-y-2",children:e.jsx(re,{name:"model",placeholder:"Product Model (e.g., CB001, PB002)",value:x.model||"",onChange:fe})}),e.jsx("div",{className:"space-y-2",children:e.jsx(ue,{name:"description",placeholder:"Product Description",value:x.description||"",onChange:fe})}),e.jsx("div",{className:"space-y-2",children:e.jsx(re,{name:"slug",placeholder:"Product URL Slug",value:x.slug||"",onChange:fe})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(re,{name:"base_price",type:"number",step:"0.01",placeholder:"Base Price (€)",value:x.base_price||"",onChange:fe}),e.jsx("p",{className:"text-sm text-gray-500",children:"This is the base price that will be used with quantity multipliers and print costs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(re,{name:"priority",type:"number",min:"1",max:"100",placeholder:"Priority (1-100)",value:x.priority||"",onChange:fe}),e.jsx("p",{className:"text-sm text-gray-500",children:"Priority determines the order products appear. Lower numbers (1-10) appear first, higher numbers (90-100) appear last."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Material"}),e.jsxs(rt,{open:S,onOpenChange:E,children:[e.jsx(at,{asChild:!0,children:e.jsxs(H,{variant:"outline",role:"combobox","aria-expanded":S,className:"w-full justify-between",children:[x.material||"Select or add material...",e.jsx(G,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(it,{className:"w-full p-0",children:e.jsxs("div",{className:"p-2",children:[e.jsx(re,{placeholder:"Search or add material...",value:z||"",onChange:e=>P(e.target.value||""),className:"mb-2"}),e.jsxs("div",{className:"max-h-[200px] overflow-y-auto",children:[(i||[]).filter(e=>e.toLowerCase().includes((z||"").toLowerCase())).map(t=>e.jsxs("div",{className:"flex items-center px-2 py-1.5 text-sm hover:bg-accent hover:text-accent-foreground cursor-pointer rounded-sm",onClick:()=>(e=>{e&&(y(t=>({...t,material:e})),E(!1),P(""))})(t),children:[e.jsx(K,{className:O("mr-2 h-4 w-4",x.material===t?"opacity-100":"opacity-0")}),t]},t)),z?.trim()&&!(i||[]).some(e=>e.toLowerCase()===(z||"").toLowerCase())&&e.jsxs("div",{className:"flex items-center px-2 py-1.5 text-sm hover:bg-accent hover:text-accent-foreground cursor-pointer rounded-sm",onClick:()=>{if(z?.trim()){const e=z.trim();y(t=>({...t,material:e})),i?.includes(e)||n(t=>[...t||[],e]),E(!1),P("")}},children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),'Add "',z,'"']})]})]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Colors"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:b.map(t=>e.jsxs(xe,{variant:"secondary",className:"flex items-center gap-1",children:[ae.find(e=>e.value===t)?.label,e.jsx("button",{onClick:()=>(e=>{v(b.filter(t=>t!==e))})(t),className:"ml-1 hover:text-destructive",children:e.jsx(A,{className:"h-3 w-3"})})]},t))}),e.jsxs(ie,{value:"",onValueChange:e=>{return t=e,void(b.includes(t)||v([...b,t]));var t},children:[e.jsx(ne,{children:e.jsx(oe,{placeholder:"Add color"})}),e.jsx(le,{children:ae.map(t=>e.jsx(ce,{value:t.value,disabled:b.includes(t.value),children:t.label},t.value))})]})]}),b.length>0&&e.jsx("div",{className:"space-y-4",children:e.jsx(vt,{onColorImagesChange:I,currentColorImages:F,availableColors:b,mainColor:L,onMainColorChange:U,productTitle:x.name})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Sizes"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:j.map(t=>e.jsxs(xe,{variant:"secondary",className:"flex items-center gap-1",children:[t,e.jsx("button",{onClick:()=>(e=>{_(j.filter(t=>t!==e))})(t),className:"ml-1 hover:text-destructive",children:e.jsx(A,{className:"h-3 w-3"})})]},t))}),e.jsx(re,{placeholder:"Add size (e.g., 38x42cm)",onKeyPress:e=>{var t;"Enter"===e.key&&((t=e.currentTarget.value).trim()&&!j.includes(t.trim())&&_([...j,t.trim()]),e.currentTarget.value="")}})]}),j.length>0&&e.jsx("div",{className:"space-y-4",children:e.jsx(jt,{onSizeImagesChange:T,currentSizeImages:D,availableSizes:j,productTitle:x.name})}),j.length>0&&c&&e.jsx("div",{className:"space-y-4",children:e.jsx(_t,{productId:c.id,sizes:j,onSizesChange:_})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-sm font-medium",children:"Product Badges"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.values(pe).map(t=>e.jsx("button",{type:"button",onClick:()=>{return e=t.id,void k(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e]);var e},className:O("inline-flex items-center gap-1.5 px-3 py-1 rounded-full border transition-colors","bg-white hover:bg-gray-50",C.includes(t.id)?"border-2":"border opacity-50"),style:{borderColor:t.borderColor,color:t.borderColor},children:t.label},t.id))})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(bt,{id:"is-eco",checked:w,onCheckedChange:e=>N(e)}),e.jsx("label",{htmlFor:"is-eco",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Öko toode"})]}),e.jsx("div",{className:"space-y-2",children:e.jsx(re,{name:"seo_title",placeholder:"SEO Title",value:x.seo_title||"",onChange:fe})}),e.jsx("div",{className:"space-y-2",children:e.jsx(ue,{name:"seo_description",placeholder:"SEO Description",value:x.seo_description||"",onChange:fe})}),e.jsx("div",{className:"space-y-2",children:e.jsx(re,{name:"seo_keywords",placeholder:"SEO Keywords",value:x.seo_keywords||"",onChange:fe})}),e.jsx(Rt,{label:"Additional Product Images",imageUrls:$,onChange:W})]}),e.jsxs(Ne,{children:[e.jsx(H,{variant:"outline",onClick:be,children:"Cancel"}),e.jsx(H,{onClick:c?async()=>{try{if(!(c&&x.name&&x.type&&x.base_price))return void me({title:"Validation error",description:"Name, type, and base price are required fields",variant:"destructive"});let e=c.image_url;if(f){const t=`${Date.now()}-${f.name.replace(/\s+/g,"-")}`,{data:s,error:r}=await q.storage.from("site-assets").upload("products/"+t,f);if(r)throw r;const{data:a}=q.storage.from("site-assets").getPublicUrl("products/"+t);e=a.publicUrl}const t={name:x.name,type:x.type,description:x.description||null,image_url:e,base_price:x.base_price,slug:x.slug||null,material:x.material||null,model:x.model||null,priority:x.priority||50,colors:b,sizes:j,is_eco:w,badges:C,color_images:F,size_images:D,updated_at:(new Date).toISOString(),main_color:L,seo_title:x.seo_title||null,seo_description:x.seo_description||null,seo_keywords:x.seo_keywords||null,additional_images:$},{data:s,error:r}=await q.from("products").update(t).eq("id",c.id).select();if(r)throw r;me({title:"Product updated",description:"Product has been updated successfully"}),be(),await se(),await de()}catch(e){me({title:"Error updating product",description:e.message,variant:"destructive"})}}:async()=>{try{if(!x.name||!x.type||!x.base_price)return void me({title:"Validation error",description:"Name, type, and base price are required fields",variant:"destructive"});let e="";if(f){const t=`${Date.now()}-${f.name.replace(/\s+/g,"-")}`,{data:s,error:r}=await q.storage.from("site-assets").upload("products/"+t,f);if(r)throw r;const{data:a}=q.storage.from("site-assets").getPublicUrl("products/"+t);e=a.publicUrl}const t={name:x.name,type:x.type,description:x.description||null,image_url:e||null,base_price:x.base_price,slug:x.slug||null,material:x.material||null,model:x.model||null,priority:x.priority||50,colors:b,sizes:j,is_eco:w,badges:C,color_images:F,size_images:D,main_color:L,seo_title:x.seo_title||null,seo_description:x.seo_description||null,seo_keywords:x.seo_keywords||null,additional_images:$},{data:s,error:r}=await q.from("products").insert(t).select();if(r)throw r;me({title:"Product added",description:"Product has been added successfully"}),be(),await se(),await de()}catch(e){me({title:"Error adding product",description:e.message,variant:"destructive"})}},children:c?"Save Changes":"Add Product"})]})]})}),e.jsx(ye,{open:h,onOpenChange:m,children:e.jsxs(_e,{children:[e.jsxs(we,{children:[e.jsx(Ce,{children:"Delete Product"}),e.jsx(ke,{children:"Are you sure you want to delete this product? This action cannot be undone."})]}),e.jsxs(Ne,{children:[e.jsx(H,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(H,{variant:"destructive",onClick:async()=>{try{if(!c)return;const{error:e}=await q.from("products").delete().eq("id",c.id);if(e)throw e;me({title:"Product deleted",description:"Product has been deleted successfully"}),m(!1),d(null),await se()}catch(e){me({title:"Error deleting product",description:e.message,variant:"destructive"})}},children:"Delete"})]})]})})]}),o?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-red-600"})}):e.jsx("div",{className:"bg-white rounded-md border",children:e.jsxs(Ee,{children:[e.jsx(Re,{children:e.jsxs(Pe,{children:[e.jsx(Oe,{children:"Name"}),e.jsx(Oe,{children:"Type"}),e.jsx(Oe,{children:"Material"}),e.jsx(Oe,{children:"Pricing"}),e.jsx(Oe,{children:"Priority"}),e.jsx(Oe,{children:"Popular"}),e.jsx(Oe,{className:"text-right",children:"Actions"})]})}),e.jsx(ze,{children:0===t.length?e.jsx(Pe,{children:e.jsx(Fe,{colSpan:6,className:"text-center py-6 text-gray-500",children:"No products added"})}):t.map(t=>e.jsxs(Pe,{children:[e.jsx(Fe,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-3",children:[t.image_url&&e.jsx("img",{src:t.image_url,alt:t.name,className:"w-10 h-10 object-contain bg-gray-100 rounded"}),e.jsx("span",{children:t.name})]})}),e.jsx(Fe,{children:ve(t.type)}),e.jsx(Fe,{children:t.material||"—"}),e.jsx(Fe,{children:e.jsx("div",{className:"text-sm",children:je(t)})}),e.jsx(Fe,{children:e.jsx(re,{type:"number",min:"1",max:"100",value:t.priority||50,onChange:e=>{const s=parseInt(e.target.value);isNaN(s)||(async(e,t)=>{try{if(1>t||t>100)return void me({title:"Invalid priority",description:"Priority must be between 1 and 100",variant:"destructive"});const{error:s}=await q.from("products").update({priority:t}).eq("id",e);if(s)throw s;me({title:"Priority updated",description:"Product priority has been updated successfully"}),await se()}catch(s){me({title:"Error updating priority",description:s.message,variant:"destructive"})}})(t.id,s)},className:"w-16 h-8 text-sm"})}),e.jsx(Fe,{children:e.jsx(H,{variant:"ghost",size:"sm",onClick:()=>(async e=>{try{if(ge(e)){const t=r.find(t=>t.product_id===e);if(t){const{error:e}=await q.from("popular_products").delete().eq("id",t.id);if(e)throw e;me({title:"Removed from popular",description:"Product has been removed from popular products"})}}else{const{error:t}=await q.from("popular_products").insert({product_id:e});if(t)throw t;me({title:"Added to popular",description:"Product has been added to popular products"})}await he()}catch(t){me({title:"Error",description:t.message,variant:"destructive"})}})(t.id),children:ge(t.id)?e.jsx(X,{className:"h-5 w-5 text-yellow-500 fill-yellow-500"}):e.jsx(Y,{className:"h-5 w-5 text-gray-400"})})}),e.jsx(Fe,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(H,{variant:"outline",size:"sm",onClick:()=>(e=>{d(e),y({type:e.type,name:e.name,description:e.description||"",base_price:e.base_price,slug:e.slug||"",material:e.material||"",model:e.model||"",priority:e.priority||50,seo_title:e.seo_title||"",seo_description:e.seo_description||"",seo_keywords:e.seo_keywords||""}),v(e.colors||[]),_(e.sizes||[]),N(e.is_eco||!1),k(e.badges||[]),I(e.color_images||{}),T(e.size_images||{}),U(e.main_color||""),W(e.additional_images||[]),p(!0)})(t),children:e.jsx(ee,{className:"h-4 w-4"})}),e.jsx(H,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700",onClick:()=>(e=>{d(e),m(!0)})(t),children:e.jsx(te,{className:"h-4 w-4"})})]})})]},t.id))})]})})]})}},Symbol.toStringTag,{value:"Module"}));export{xe as B,ye as D,Et as I,zt as P,Ee as T,be as a,_e as b,we as c,Ce as d,Ne as e,Re as f,Pe as g,Oe as h,ze as i,Fe as j,ke as k,Se as l};
